# Исходные данные для заданий

## Окружение

Задания выполняются в БД PostgreSQL.

## Таблица Emp

Empno \-- Таб. номер

EName \-- Имя\
Job \-- Должность

Mgr \-- Начальник

Hiredate \-- Дата приема

Sal \-- Оклад

Comm \-- Бонус

Deptno \-- Отдел

(Данные содержатся в файле emp.csv)

## Таблица Operations

Operation_Id \-- Id операции\
Account_Id \-- Id счета\
Operation_Type \-- Тип операции

CHECK (Operation_Type IN (\'D\', \'C\'))\
Operation_Date \-- Дата операции\
Agreement_Num \-- Номер договора\
Amount \-- Сумма операции

(Данные содержатся в файле operations.csv)

## Таблица Org

Org_Id \-- Id организации\
Parent_Id \-- Id родительской организации\
Org_Name \-- Наименование организации

(Данные содержатся в файле org.csv)

## Таблица Summary

Org_Id \-- Id организации

Operation_Date \-- Дата операции\
Operation_Sum \-- Выручка за день

(Данные содержатся в файле summary.csv)

## ВАЖНО: все csv файлы должны быть загружены без изменений

# Задание 1 (SQL)

**Сложность:** низкая -- ниже средней.

Написать SQL-запрос, выбирающий из таблицы Emp следующие данные для
отчета по подразделениям (ниже перечислены столбцы):

-   Номер подразделения (Deptno).1

-   Общее число сотрудников подразделения.1

-   Число сотрудников подразделения, принятых на работу (Hiredate) в
    январе 2009 г.2

-   Суммарный оклад (Sal) всех сотрудников подразделения.1

-   Процентная доля оклада сотрудников подразделения, принятых на работу
    (Hiredate) в январе 2009 г., в суммарном окладе сотрудников
    подразделения.2

Результат отсортировать в порядке возрастания номера подразделения.

**Усложненные варианты (сложность средняя):**

a.  Выбрать аналогичные данные по сотрудникам, подчиненным (как
    непосредственно, так и опосредованно, по иерархии подчинения)
    заданному сотруднику (использовать номер сотрудника 7698).
    Идентификатор (Empno) непосредственного руководителя сотрудника
    содержится в поле Mgr.

# Задание 2 (SQL)

**Сложность:** выше средней

Запрос должен выбирать данные в представленной форме, выборка дебетовых
и кредитовых операций в разных строках не засчитывается как правильное
решение задачи.

Параметрами отчета являются идентификатор счета (одно значение) и
отчетный период (дата начала и дата конца периода; граничные даты входят
в период).

Результирующие строки должны быть отсортированы по дате операции и
номеру договора; сортировка внутри этих групп - на усмотрение
разработчика.

Создание view, вспомогательных функций и т.п. -- на усмотрение
разработчика.

1.  Выполнил задачу 1.1. и 1.2.

2.  Задача 2. Приблизился максимлаьно близко к необходимому результату.
    Есть понимание, что в временной таблице t2 нужно корректно подобрать
    ограничения по строкам и типу фрейма. 00is_null. Использовал, т. к.
    сортировка по null не позволяет выдать результат как в контрольном
    примере. Скриншот прилагаю

3.  Решил задачу 3.a. По задаче 3.b сделал частично (посчитаны суммы по
    агрегации 2-го уровня вложенности, см. скриншот). Продолжать не
    стал, т. к. есть подозрения что я не глубоко знаю рекурсию в SQL и
    задача решается намного легче.

# Задание 3 (SQL)

**Сложность:** низкая -- ниже средней

Данные в таблице Summary содержат информацию только для самого нижнего
уровня. Написать SQL -- запрос, выбирающий из таблиц Org и Summary
данные для отчета по нижним организационным структурам.

Результирующая таблица должна содержать сумму операций по организации
(выручка по организации), сумму операций по всем операциям (общая
выручка за день) и долю в процентах по каждой организации (которую
составляет выручка по организации от общей выручки за день).

Результирующие строки должны быть отсортированы по организации и по
дате.

Создание view, вспомогательных функций и т.п. -- на усмотрение
разработчика.

**Усложненные варианты (сложность выше средней):**

b.  Данные в таблице Summary содержат информацию только для самого
    нижнего уровня, для всех родительских организаций сумма должна быть
    посчитана. Иерархическое подчинение строится по полю parent_id,
    корневой организацией считается та, у которой parent_id = null. Как
    и в основном варианте результирующая таблица должна содержать сумму
    операций по организации (выручка по организации), сумму по всем
    операциям (общая выручка за день) и долю в процентах по каждой
    организации (которую составляет выручка по организации от общей
    выручки за день)
